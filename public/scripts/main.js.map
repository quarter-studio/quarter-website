{"version":3,"file":"main.js","sources":["../../scripts/main.js","../../scripts/shader.js","../../scripts/shaders/noise.js","../../scripts/support.js"],"sourcesContent":["import noise from './shaders/noise.js'\nimport shader from './shader.js'\nimport { load } from './support.js';\nimport '../styles/main.sass'\n\nvar canvas = document.querySelector('.shader')\n\nwindow.animation = shader(canvas, noise)\n\n// resize the canvas\nvar resize = () => {\n  twgl.resizeCanvasToDisplaySize(canvas);\n  canvas.getContext('webgl').viewport(0, 0, canvas.width, canvas.height);\n  animation.set('resolution', [canvas.width, canvas.height])\n}\n\nwindow.addEventListener('resize', resize)\n\nresize()\n\n// turn off rendering if off screen\nvar scroll = () => {\n  animation.enabled = window.pageYOffset < window.innerHeight * 1.15;\n}\n\nwindow.addEventListener('scroll', scroll)\n\nscroll()\n\n// update data by frame\nvar render = (time) => {\n  animation.set('time', time * 0.001)\n  animation.render()\n  requestAnimationFrame(render)\n}\n\nrender(0)\n\n// load editor with tilde key\nvar keydown = (event) => {\n  if (event.keyCode === 192) {\n    load('/scripts/editor.js')\n    window.removeEventListener('keydown', keydown)\n  }\n}\n\nwindow.addEventListener('keydown', keydown)\n\nkeydown({ keyCode: 192 })\n","export default (canvas, config) => {\n  var context = canvas.getContext('webgl')\n  var buffer = twgl.createBufferInfoFromArrays(context, config.buffer)\n  var fs = config.fs\n\n  for (var key in config.options) {\n    fs = fs.replace('#endif', `#endif\\nuniform float u_${key};\\n`)\n  }\n\n  var textures = {\n    ...config.textures\n  }\n\n  for (var key in textures) {\n    var texture = textures[key] = {\n      ...textures[key]\n    }\n\n    if (texture.mag) {\n      texture.mag = context[texture.mag]\n    }\n  }\n\n  textures = twgl.createTextures(context, textures)\n\n  var program = twgl.createProgramInfo(context, [config.vs, fs])\n\n  context.useProgram(program.program)\n\n  twgl.setBuffersAndAttributes(context, program, buffer)\n\n  var uniforms = {\n    u_time: 0,\n    u_mouse: [0,0]\n  }\n\n  var shader = {\n    _uniforms: uniforms, // hack for reactive editor\n    enabled: true,\n    options: Object.keys(config.options),\n    render: () => {\n      if (shader.enabled) {\n        twgl.setUniforms(program, uniforms)\n        twgl.drawBufferInfo(context, buffer)\n      }\n    },\n    get: (key) => uniforms[`u_${key}`],\n    set: (key, value) => {\n      uniforms[`u_${key}`] = value\n    }\n  }\n\n  for (var key in config.textures) {\n    shader.set(key, textures[key])\n  }\n\n  for (var key in config.options) {\n    shader.set(key, config.options[key])\n  }\n\n  return shader\n}\n","import fs from './noise.fs'\nimport vs from './noise.vs'\n\nexport default {\n  fs: fs,\n  vs: vs,\n  buffer: {\n    position: [\n      -1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0\n    ]\n  },\n  textures: {\n    noise: {\n      // mag: context.NEAREST,\n      mag: 'NEAREST',\n      src: '/images/noise.png'\n    },\n    terrain: {\n      src: '/images/terrain.png'\n    }\n  },\n  options: {\n    blur_x: .5,\n    blur_y: .55,\n    dither: .3,\n    size: .3,\n    edge: .425,\n    gamma: .3,\n    viscosity: .15,\n  }\n}\n","export var load = (url, method) => {\n  var script = document.createElement('script')\n  script.src = url\n  script.onload = method\n  return document.body.appendChild(script)\n}"],"names":["canvas","document","querySelector","window","animation","shader","config","context","getContext","buffer","twgl","createBufferInfoFromArrays","fs","key","options","replace","textures","texture","mag","createTextures","program","createProgramInfo","vs","useProgram","setBuffersAndAttributes","uniforms","u_time","u_mouse","_uniforms","enabled","Object","keys","render","setUniforms","drawBufferInfo","get","set","value","noise","position","src","terrain","blur_x","blur_y","dither","size","edge","gamma","viscosity","resize","resizeCanvasToDisplaySize","viewport","width","height","addEventListener","scroll","pageYOffset","innerHeight","time","requestAnimationFrame","keydown","event","keyCode","script","createElement","url","onload","method","body","appendChild","removeEventListener"],"mappings":"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"}